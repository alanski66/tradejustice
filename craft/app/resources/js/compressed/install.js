!function(h){Craft.Installer=Garnish.Base.extend({$bg:null,$screens:null,$currentScreen:null,$accountSubmitBtn:null,$siteSubmitBtn:null,loading:!1,init:function(){this.$bg=h("#bg"),this.$screens=Garnish.$bod.children(".modal"),this.addListener(h("#beginbtn"),"activate","showAccountScreen")},showAccountScreen:function(t){this.showScreen(1,h.proxy(function(){h("#beginbtn").remove(),this.$accountSubmitBtn=h("#accountsubmit"),this.addListener(this.$accountSubmitBtn,"activate","validateAccount"),this.addListener(h("#accountform"),"submit","validateAccount")},this))},validateAccount:function(t){t.preventDefault();this.validate("account",["username","email","password"],h.proxy(this,"showSiteScreen"))},showSiteScreen:function(){this.showScreen(2,h.proxy(function(){this.$siteSubmitBtn=h("#sitesubmit"),this.addListener(this.$siteSubmitBtn,"activate","validateSite"),this.addListener(h("#siteform"),"submit","validateSite")},this))},validateSite:function(t){t.preventDefault();this.validate("site",["siteName","siteUrl"],h.proxy(this,"showInstallScreen"))},showInstallScreen:function(){this.showScreen(3,h.proxy(function(){for(var t=["username","email","password","siteName","siteUrl","locale"],e={},i=0;i<t.length;i++){var n=t[i],s=h("#"+n);e[n]=Garnish.getInputPostVal(s)}Craft.postActionRequest("install/install",e,h.proxy(this,"allDone"),{complete:h.noop})},this))},allDone:function(t,e){if("success"==e&&t.success){this.$currentScreen.find("h1:first").text(Craft.t("All done!"));var i=h('<div class="buttons"/>'),n=h('<div class="btn big submit">'+Craft.t("Go to Craft CMS")+"</div>").appendTo(i);h("#spinner").replaceWith(i),this.addListener(n,"click",function(){this.showScreen(30,null,1e3),setTimeout(function(){window.location.href=Craft.getUrl("dashboard")},Craft.Installer.duration)})}else this.$currentScreen.find("h1:first").text("Oops.")},showScreen:function(t,e,i){i||(i=Craft.Installer.duration),this.$bg.velocity({left:"-"+5*t+"%"},i);var n=Garnish.$win.width(),s=Math.floor(n/2);this.$currentScreen&&this.$currentScreen.css("left",s).velocity({left:-400},Craft.Installer.duration),this.$currentScreen=h(this.$screens[t-1]).css({display:"block",left:n+400}).velocity({left:s},Craft.Installer.duration,h.proxy(function(){this.$currentScreen.css("left","50%"),this.focusFirstInput(),e()},this))},validate:function(t,e,l){if(!this.loading){this.loading=!0,h("#"+t+"form").find(".errors").remove();var u=this["$"+t+"SubmitBtn"];u.addClass("sel loading");for(var i="install/validate"+Craft.uppercaseFirst(t),n={},s=0;s<e.length;s++){var r=e[s],a=h("#"+r);n[r]=Garnish.getInputPostVal(a)}Craft.postActionRequest(i,n,h.proxy(function(t,e){if(this.loading=!1,u.removeClass("sel loading"),"success"==e)if(t.validates)l();else{for(var i in t.errors){for(var n=t.errors[i],s=h("#"+i),r=s.closest(".field"),a=h('<ul class="errors"/>').appendTo(r),o=0;o<n.length;o++){var c=n[o];h("<li>"+c+"</li>").appendTo(a)}s.is(":focus")||(s.addClass("error"),h.proxy(function(t){this.addListener(t,"focus",function(){t.removeClass("error"),this.removeListener(t,"focus")})},this)(s))}Garnish.shake(this.$currentScreen)}},this))}},focusFirstInput:function(){setTimeout(h.proxy(function(){this.$currentScreen.find("input:first").trigger("focus")},this),Craft.Installer.duration)}},{duration:300}),Garnish.$win.on("load",function(){Craft.installer=new Craft.Installer})}(jQuery);
//# sourceMappingURL=install.js.map