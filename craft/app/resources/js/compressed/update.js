!function(s){Craft.Updater=Garnish.Base.extend({$graphic:null,$status:null,$errorDetails:null,data:null,init:function(t){this.$graphic=s("#graphic"),this.$status=s("#status"),t&&t.handle?(this.data=t,this.postActionRequest("update/prepare")):this.showError(Craft.t("Unable to determine what to update."))},updateStatus:function(t){this.$status.html(t)},showError:function(t){this.updateStatus(t),this.$graphic.addClass("error")},postActionRequest:function(t){var e={data:this.data};Craft.postActionRequest(t,e,s.proxy(function(t,e,s){"success"==e&&t.alive?this.onSuccessResponse(t):this.onErrorResponse(s)},this),{complete:s.noop})},onSuccessResponse:function(t){if(t.data&&(this.data=t.data),t.errorDetails&&(this.$errorDetails=t.errorDetails),t.nextStatus&&this.updateStatus(t.nextStatus),t.nextAction&&this.postActionRequest(t.nextAction),t.finished){var e=!1;t.rollBack&&(e=!0),this.onFinish(t.returnUrl,e)}},onErrorResponse:function(t){this.$graphic.addClass("error");var e="<p>"+Craft.t("A fatal error has occurred:")+'</p><div id="error" class="code"><p><strong class="code">'+Craft.t("Status:")+"</strong> "+Craft.escapeHtml(t.statusText)+'</p><p><strong class="code">'+Craft.t("Response:")+"</strong> "+Craft.escapeHtml(t.responseText)+'</p></div><a class="btn submit big" href="mailto:support@craftcms.com?subject='+encodeURIComponent("Craft update failure")+"&body="+encodeURIComponent("Describe what happened here.\n\n-----------------------------------------------------------\n\nStatus: "+t.statusText+"\n\nResponse: "+t.responseText)+'">'+Craft.t("Send for help")+"</a>";this.updateStatus(e)},onFinish:function(t,e){if(this.$errorDetails){this.$graphic.addClass("error");var s=Craft.t("Craft was unable to install this update :(")+"<br /><p>";s+=e?Craft.t("The site has been restored to the state it was in before the attempted update.")+"</p><br /><p>":Craft.t("No files have been updated and the database has not been touched.")+"</p><br /><p>",s+=this.$errorDetails+"</p>",this.updateStatus(s)}else this.updateStatus(Craft.t("All done!")),this.$graphic.addClass("success"),setTimeout(function(){window.location=t?Craft.getUrl(t):Craft.getUrl("dashboard")},500)}})}(jQuery);
//# sourceMappingURL=update.js.map